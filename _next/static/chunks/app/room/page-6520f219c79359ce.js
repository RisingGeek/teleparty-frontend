(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[576],{928:(e,s,t)=>{Promise.resolve().then(t.bind(t,9985))},2056:(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SocketCallbackManager=void 0;class t{constructor(){this._callbackMap=new Map}makeId(){let e="";for(let s=0;s<16;s+=1)e+="0123456789abcdef"[Math.floor(16*Math.random())];return e}executeCallback(e,s){let t=this._callbackMap.get(e);t&&(t(s),this._callbackMap.delete(e))}addCallback(e){let s=this.makeId();for(;this._callbackMap.has(s);)s=this.makeId();return this._callbackMap.set(s,e),s}}s.SocketCallbackManager=t},4962:(e,s,t)=>{"use strict";t.d(s,{NotificationProvider:()=>u,h:()=>d});var r=t(5155),n=t(2115),a=t(7650);let o={success:"bg-green-500",info:"bg-blue-500",warning:"bg-yellow-500 text-black",error:"bg-red-500"};function i(e){let{type:s,message:t,description:n}=e;return(0,r.jsxs)("div",{className:"rounded-md shadow-md p-4 text-white ".concat(o[s]),children:[(0,r.jsx)("div",{className:"font-semibold",children:t}),(0,r.jsx)("div",{className:"text-sm mt-1 opacity-90",children:n})]})}let c=(0,n.createContext)(null),l=0;function u(e){let{children:s}=e,[t,o]=(0,n.useState)([]),[u,d]=(0,n.useState)(null),m=(0,n.useCallback)((e,s)=>{let{message:t,description:r}=s,n=l++;o(s=>[...s,{id:n,type:e,message:t,description:r}]),setTimeout(()=>{o(e=>e.filter(e=>e.id!==n))},4e3)},[]),h=(0,n.useMemo)(()=>({success:e=>m("success",e),info:e=>m("info",e),warning:e=>m("warning",e),error:e=>m("error",e)}),[m]),g=u?(0,a.createPortal)((0,r.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2",children:t.map(e=>(0,r.jsx)(i,{...e},e.id))}),u):null;return(0,r.jsx)(c.Provider,{value:{api:h,contextHolder:g,setContainer:d},children:s})}function d(){let e=(0,n.useContext)(c);if(!e)throw Error("useNotification must be used within a NotificationProvider");return[e.api,e.contextHolder,e.setContainer]}},5809:(e,s,t)=>{"use strict";s.Ul=s.mw=void 0;let r=t(8974);Object.defineProperty(s,"mw",{enumerable:!0,get:function(){return r.SocketMessageTypes}});let n=t(7774);Object.defineProperty(s,"Ul",{enumerable:!0,get:function(){return n.TelepartyClient}})},6046:(e,s,t)=>{"use strict";var r=t(6658);t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},7774:function(e,s,t){"use strict";var r=this&&this.__awaiter||function(e,s,t,r){return new(t||(t=Promise))(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var s;e.done?n(e.value):((s=e.value)instanceof t?s:new t(function(e){e(s)})).then(o,i)}c((r=r.apply(e,s||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.TelepartyClient=void 0;let n=t(2056),a=t(8974);class o{constructor(e){this._socketEventHandler=e,this._socket=new WebSocket("wss://uwstest.teleparty.com"),this._callbackManager=new n.SocketCallbackManager,this._handleSocketEvents(),this._reconnectAttempts=0}_handleSocketEvents(){this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onopen=this._onOpen.bind(this)}_onMessage(e){try{let s=JSON.parse(e.data);s.callbackId?this._callbackManager.executeCallback(s.callbackId,s.data):this._socketEventHandler.onMessage(s)}catch(e){}}_onOpen(){this._socketEventHandler.onConnectionReady()}_onClose(e){this._socketEventHandler.onClose()}_onError(e){this._socket.close()}_formatMessage(e,s,t){return{type:e,data:s,callbackId:t}}joinChatRoom(e,s,t){return r(this,void 0,void 0,function*(){let r={videoId:"0",sessionId:s,videoService:"netflix",permId:"0000000000000000",userSettings:{userIcon:t,userNickname:e}},n=yield new Promise(e=>{this.sendMessage(a.SocketMessageTypes.JOIN_SESSION,r,s=>{e(s)})});if(n.errorMessage)throw Error(n.errorMessage);return{messages:n.messages}})}createChatRoom(e,s){return r(this,void 0,void 0,function*(){let t={controlLock:!1,videoId:"0",videoDuration:0,videoService:"netflix",permId:"0000000000000000",userSettings:{userIcon:s,userNickname:e}},r=yield new Promise(e=>{this.sendMessage(a.SocketMessageTypes.CREATE_SESSION,t,s=>{e(s)})});if(r.errorMessage)throw Error(r.errorMessage);return r.sessionId})}sendMessage(e,s,t){if(1==this._socket.readyState){let r="null";t&&(r=this._callbackManager.addCallback(t));let n=this._formatMessage(e,s,r);this._socket.send(JSON.stringify(n))}else t&&t({errorMessage:"Connection isn't Ready yet."})}teardown(){try{this._socket.close(4500)}catch(e){}this._reconnectTimeOut&&clearTimeout(this._reconnectTimeOut),this._keepAliveInterval&&clearInterval(this._keepAliveInterval)}}s.TelepartyClient=o},8974:(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SocketMessageTypes=void 0,function(e){e.CREATE_SESSION="createSession",e.JOIN_SESSION="joinSession",e.SEND_MESSAGE="sendMessage",e.SET_TYPING_PRESENCE="setTypingPresence"}(s.SocketMessageTypes||(s.SocketMessageTypes={}))},9985:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var r=t(5155),n=t(4962),a=t(6046),o=t(2115),i=t(5809);let c=()=>{let e=(0,a.useSearchParams)().get("roomId"),[s,t]=(0,o.useState)([]),[c,l]=(0,o.useState)(""),[u,d]=(0,o.useState)(""),[m,h]=(0,o.useState)(!1),[g,f]=(0,o.useState)([]),[p,v]=(0,o.useState)([]),[b,x]=(0,o.useState)([]),[k,S]=(0,o.useState)(!0),[y,_]=(0,o.useState)(""),N=(0,o.useRef)(null),w=(0,o.useRef)(!0),[E,M,j]=(0,n.h)(),I=(0,o.useRef)(null),C=(0,o.useRef)(null),T=(0,a.useRouter)();(0,o.useEffect)(()=>{var e;null===(e=I.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]),(0,o.useEffect)(()=>{!k&&N.current&&j(N.current)},[k,j]),(0,o.useEffect)(()=>{let s={onConnectionReady:async()=>{let s=sessionStorage.getItem("teleparty-nickname")||"";d(s);try{var r;let n=await (null===(r=C.current)||void 0===r?void 0:r.joinChatRoom(s,e||"","userIcon")),a=null==n?void 0:n.messages.map(e=>({isSystemMessage:e.isSystemMessage,userIcon:e.userIcon,userNickname:e.userNickname,body:e.body,permId:e.permId,timestamp:e.timestamp}));a&&t(a)}catch(e){e instanceof Error?e.message.includes("Invalid session id")&&(console.log("wrong chat room"),E.error({message:"Room ID does not exist",description:"Redirecting to home page"}),setTimeout(()=>{T.push("/")},2e3)):console.error("Unknown error occured",e)}S(!1)},onClose:()=>{if(!w.current)return;console.log("Socket has been closed"),E.info({message:"Connection Lost, Reconnecting...",description:"Connection has been lost. Please wait for reconnection"});let e=new i.Ul(s);C.current=e},onMessage:e=>{let{type:s,data:r}=e;switch(console.log("message",e),s){case i.mw.SEND_MESSAGE:t(e=>[...e,r]);break;case"userList":let n=r.map(e=>({userId:e.socketConnectionId,userNickname:e.userSettings.userNickname,userIcon:e.userSettings.userIcon}));console.log("users",n,r),f(n);break;case i.mw.SET_TYPING_PRESENCE:v(r.usersTyping);break;case"userId":console.log("user id",r.userId),_(r.userId)}}},r=new i.Ul(s);return console.log("client",r),C.current=r,()=>{var e;w.current=!1,null===(e=C.current)||void 0===e||e.teardown()}},[e]),(0,o.useEffect)(()=>{var e;console.log("type",m),null===(e=C.current)||void 0===e||e.sendMessage(i.mw.SET_TYPING_PRESENCE,{typing:m})},[m]),(0,o.useEffect)(()=>{x(p.filter(e=>e!==y).map(e=>{var s;return(null===(s=g.find(s=>s.userId===e))||void 0===s?void 0:s.userNickname)||""}))},[p,g,y]);let P=e=>{var s;null==e||e.preventDefault();let t=c.trim();t&&(h(!1),null===(s=C.current)||void 0===s||s.sendMessage(i.mw.SEND_MESSAGE,{body:t}),l(""))};return k?(0,r.jsx)("div",{className:"flex flex-col justify-center items-center h-96",children:(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"flex flex-col h-96",children:[(0,r.jsx)("div",{className:"p-4 bg-gray-100 border-b",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"font-semibold text-black",children:["Room: ",e]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["You: ",u]})]}),(0,r.jsx)("button",{className:"text-sm bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded cursor-pointer",onClick:()=>{var e;null===(e=C.current)||void 0===e||e.teardown(),T.replace("/")},children:"Leave Room"})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 overflow-y-auto p-4",ref:N,children:M}),s.map((e,s)=>(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"max-w-xs px-4 py-2 rounded-lg ".concat(e.isSystemMessage?"bg-gray-200 text-gray-800":"bg-gray-300 text-gray-800"),children:[!e.isSystemMessage&&(0,r.jsx)("div",{className:"text-xs font-semibold mb-1",children:e.userNickname}),(0,r.jsx)("p",{children:e.isSystemMessage?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"font-bold",children:[e.userNickname," "]}),(0,r.jsx)("span",{children:e.body})]}):e.body}),(0,r.jsx)("div",{className:"text-xs text-right mt-1 opacity-75",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"numeric"})})]})},s)),(0,r.jsx)("div",{ref:I})]}),b.length>0&&(0,r.jsx)("div",{className:"text-sm text-gray-500 italic mb-2 pl-4",children:1===b.length?"".concat(b[0]," is typing..."):"".concat(Array.from(b).join(", ")," are typing...")}),(0,r.jsx)("div",{className:"p-4 border-t",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("textarea",{value:c,onChange:e=>{m||(h(!0),setTimeout(()=>{h(!1)},3e3)),l(e.target.value)},className:"flex-1 p-2 border rounded text-black",placeholder:"Type a message...",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},rows:1}),(0,r.jsx)("button",{onClick:P,className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded cursor-pointer",children:"Send"})]})})]})},l=()=>(0,r.jsx)(o.Suspense,{children:(0,r.jsx)(c,{})})}},e=>{var s=s=>e(e.s=s);e.O(0,[441,587,358],()=>s(928)),_N_E=e.O()}]);