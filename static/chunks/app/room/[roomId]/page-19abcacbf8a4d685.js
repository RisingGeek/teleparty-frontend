(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{1673:(e,s,t)=>{Promise.resolve().then(t.bind(t,2952))},2056:(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SocketCallbackManager=void 0;class t{constructor(){this._callbackMap=new Map}makeId(){let e="";for(let s=0;s<16;s+=1)e+="0123456789abcdef"[Math.floor(16*Math.random())];return e}executeCallback(e,s){let t=this._callbackMap.get(e);t&&(t(s),this._callbackMap.delete(e))}addCallback(e){let s=this.makeId();for(;this._callbackMap.has(s);)s=this.makeId();return this._callbackMap.set(s,e),s}}s.SocketCallbackManager=t},2952:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var r=t(5155),a=t(6046),n=t(2115),o=t(5809);let i=()=>{let{roomId:e}=(0,a.useParams)(),[s,t]=(0,n.useState)([]),[i,c]=(0,n.useState)(""),[l,d]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1),[m,g]=(0,n.useState)([]),[p,v]=(0,n.useState)([]),[k,b]=(0,n.useState)([]),[S,f]=(0,n.useState)(!0),[_,x]=(0,n.useState)(""),y=(0,n.useRef)(null),E=(0,n.useRef)(null),M=(0,a.useRouter)();return((0,n.useEffect)(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]),(0,n.useEffect)(()=>{let s=new o.Ul({onConnectionReady:()=>{var s;let t=sessionStorage.getItem("teleparty-nickname")||"";d(t),null===(s=E.current)||void 0===s||s.joinChatRoom(t,e,"userIcon"),f(!1)},onClose:()=>{console.log("Socket has been closed")},onMessage:e=>{let{type:s,data:r}=e;switch(console.log("message",e),s){case o.mw.SEND_MESSAGE:t(e=>[...e,r]);break;case"userList":let a=r.map(e=>({userId:e.socketConnectionId,userNickname:e.userSettings.userNickname,userIcon:e.userSettings.userIcon}));console.log("users",a,r),g(a);break;case o.mw.SET_TYPING_PRESENCE:v(r.usersTyping);break;case"userId":x(r.userId)}}});return E.current=s,()=>{var e;null===(e=E.current)||void 0===e||e.teardown()}},[e]),(0,n.useEffect)(()=>{var e;console.log("type",u),null===(e=E.current)||void 0===e||e.sendMessage(o.mw.SET_TYPING_PRESENCE,{typing:u})},[u]),(0,n.useEffect)(()=>{b(p.filter(e=>e!==_).map(e=>{var s;return(null===(s=m.find(s=>s.userId===e))||void 0===s?void 0:s.userNickname)||""}))},[p,m,_]),S)?(0,r.jsx)("div",{className:"flex flex-col justify-center items-center h-96",children:(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):(0,r.jsxs)("div",{className:"flex flex-col h-96",children:[(0,r.jsx)("div",{className:"p-4 bg-gray-100 border-b",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"font-semibold text-black",children:["Room: ",e]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["You: ",l]})]}),(0,r.jsx)("button",{className:"text-sm bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded cursor-pointer",onClick:()=>{var e;null===(e=E.current)||void 0===e||e.teardown(),M.replace("/")},children:"Leave Room"})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[s.map((e,s)=>(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"max-w-xs px-4 py-2 rounded-lg ".concat(e.isSystemMessage?"bg-gray-200 text-gray-800":"bg-gray-300 text-gray-800"),children:[!e.isSystemMessage&&(0,r.jsx)("div",{className:"text-xs font-semibold mb-1",children:e.userNickname}),(0,r.jsx)("p",{children:e.isSystemMessage?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"font-bold",children:[e.userNickname," "]}),(0,r.jsx)("span",{children:e.body})]}):e.body}),(0,r.jsx)("div",{className:"text-xs text-right mt-1 opacity-75",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"numeric",minute:"numeric"})})]})},s)),(0,r.jsx)("div",{ref:y})]}),k.length>0&&(0,r.jsx)("div",{className:"text-sm text-gray-500 italic mb-2 pl-4",children:1===k.length?"".concat(k[0]," is typing..."):"".concat(Array.from(k).join(", ")," are typing...")}),(0,r.jsx)("div",{className:"p-4 border-t",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:i,onChange:e=>{u||(h(!0),setTimeout(()=>{h(!1)},3e3)),c(e.target.value)},className:"flex-1 p-2 border rounded text-black",placeholder:"Type a message..."}),(0,r.jsx)("button",{onClick:e=>{var s;e.preventDefault();let t=i.trim();t&&(h(!1),null===(s=E.current)||void 0===s||s.sendMessage(o.mw.SEND_MESSAGE,{body:t}),c(""))},className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded cursor-pointer",children:"Send"})]})})]})}},5809:(e,s,t)=>{"use strict";s.Ul=s.mw=void 0;let r=t(8974);Object.defineProperty(s,"mw",{enumerable:!0,get:function(){return r.SocketMessageTypes}});let a=t(7774);Object.defineProperty(s,"Ul",{enumerable:!0,get:function(){return a.TelepartyClient}})},6046:(e,s,t)=>{"use strict";var r=t(6658);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}})},7774:function(e,s,t){"use strict";var r=this&&this.__awaiter||function(e,s,t,r){return new(t||(t=Promise))(function(a,n){function o(e){try{c(r.next(e))}catch(e){n(e)}}function i(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var s;e.done?a(e.value):((s=e.value)instanceof t?s:new t(function(e){e(s)})).then(o,i)}c((r=r.apply(e,s||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.TelepartyClient=void 0;let a=t(2056),n=t(8974);class o{constructor(e){this._socketEventHandler=e,this._socket=new WebSocket("wss://uwstest.teleparty.com"),this._callbackManager=new a.SocketCallbackManager,this._handleSocketEvents(),this._reconnectAttempts=0}_handleSocketEvents(){this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onopen=this._onOpen.bind(this)}_onMessage(e){try{let s=JSON.parse(e.data);s.callbackId?this._callbackManager.executeCallback(s.callbackId,s.data):this._socketEventHandler.onMessage(s)}catch(e){}}_onOpen(){this._socketEventHandler.onConnectionReady()}_onClose(e){this._socketEventHandler.onClose()}_onError(e){this._socket.close()}_formatMessage(e,s,t){return{type:e,data:s,callbackId:t}}joinChatRoom(e,s,t){return r(this,void 0,void 0,function*(){let r={videoId:"0",sessionId:s,videoService:"netflix",permId:"0000000000000000",userSettings:{userIcon:t,userNickname:e}},a=yield new Promise(e=>{this.sendMessage(n.SocketMessageTypes.JOIN_SESSION,r,s=>{e(s)})});if(a.errorMessage)throw Error(a.errorMessage);return{messages:a.messages}})}createChatRoom(e,s){return r(this,void 0,void 0,function*(){let t={controlLock:!1,videoId:"0",videoDuration:0,videoService:"netflix",permId:"0000000000000000",userSettings:{userIcon:s,userNickname:e}},r=yield new Promise(e=>{this.sendMessage(n.SocketMessageTypes.CREATE_SESSION,t,s=>{e(s)})});if(r.errorMessage)throw Error(r.errorMessage);return r.sessionId})}sendMessage(e,s,t){if(1==this._socket.readyState){let r="null";t&&(r=this._callbackManager.addCallback(t));let a=this._formatMessage(e,s,r);this._socket.send(JSON.stringify(a))}else t&&t({errorMessage:"Connection isn't Ready yet."})}teardown(){try{this._socket.close(4500)}catch(e){}this._reconnectTimeOut&&clearTimeout(this._reconnectTimeOut),this._keepAliveInterval&&clearInterval(this._keepAliveInterval)}}s.TelepartyClient=o},8974:(e,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SocketMessageTypes=void 0,function(e){e.CREATE_SESSION="createSession",e.JOIN_SESSION="joinSession",e.SEND_MESSAGE="sendMessage",e.SET_TYPING_PRESENCE="setTypingPresence"}(s.SocketMessageTypes||(s.SocketMessageTypes={}))}},e=>{var s=s=>e(e.s=s);e.O(0,[441,587,358],()=>s(1673)),_N_E=e.O()}]);